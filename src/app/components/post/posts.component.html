<app-header></app-header>

<div class="d-flex justify-content-center" *ngIf="posts.length==0">
    <div class="card divCard" style="width: 38rem;">
        <div class="card-header header">
            <div class="card-body body">
                <h1 class="initialText" > NOTHING TO SHOW YET!</h1>
            </div>
        </div>
    </div>
</div>
<div class="d-flex justify-content-center postCardOut" *ngFor="let post of posts">
    <div class="card divCard" style="width: 38rem;">
        <div class="card-header header">
            <div class="row">
                <div class="col-1 radius">
                    <img src="/assets/conversation.png" class="userImage" alt="user">
                </div>
                <div class="col">
                    <div *ngIf="post.user"><span> {{ post.user.fname }}</span><span> {{ post.user.lastname }}</span></div>
                    <div><span>
                            {{ post['date'] |date }}
                        </span></div>
                </div>
                <div class="col-auto">
                    <button style="background-color:transparent;" [matMenuTriggerFor]="appMenu" >
                        <span class="material-icons"style="font: size 20px;">more_horiz</span>
                    </button>
                    <mat-menu #appMenu="matMenu">
                        <button mat-menu-item (click)="editPost(post['_id'],newDescription,validate,cancel)">Edit</button>
                        <button mat-menu-item (click)="delete(post['_id'])">Delete</button>
                        <button mat-menu-item>Report</button>
                    </mat-menu>
                </div>
            </div>
        </div>
        <div class="card-body body">
            <div class="row">
                <div #description *ngIf="showOldDescription" class="col-auto">{{ post['description'] }}</div>
                <textarea #newDescription style="display:none"></textarea>
                <button #validate (click)="validatePost(post['_id'],newDescription,validate,cancel)" style="display: none">valider</button>
                <button #cancel (click)="cancelPostChanges(newDescription,validate,cancel)"  style="display: none">cancel</button>
            </div>
            <hr>
            <div class="row">
                <div class="col-sm-3" *ngFor="let image of post['images']">
                    <img src="{{ image }}" alt="post images " class="post">
                </div>
            </div>
        </div>
        <div class="row">
          
          
      <div class="col-sm" style="margin-left: 10px">
                <label>{{ post['likes'].length }} people likes</label>
            </div>
            <div class="col-sm">
                <label style="float: right;margin-right: 10px;">{{ post['comments'].length }} comments</label>
            </div>
        </div>
        <div class="card-footer footer" >
            <div class="row justify-content-center">
                <div class="col-sm-3" style="text-align:center;">
                    <button mat-icon-button   (click)="addlike(post['_id'])">
                        <span class="material-icons-outlined">favorite</span>
                    </button>
                </div>
                <div class="col-sm-3" style="text-align:center;">
                    <button mat-icon-button  aria-label="Example icon button with a heart icon"
                        [routerLink]="['showAllComments',post['_id']]" (click)="showSection(posts.indexOf(post))">
                        <span class="material-icons-outlined">comment</span> 
                    </button>
                </div>
                <div class="col-sm-3" style="text-align:center;">
                    <button mat-icon-button aria-label="Example icon button with a heart icon">
                        <span class="material-icons-outlined">send</span>
                    </button>
                </div>
            </div>
            <div class="d-flex justify-content-center" *ngIf="showComments[posts.indexOf(post)]">
                <div class="card" style="width: 38rem;">
                    <div class="card-body">
                        <router-outlet></router-outlet>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>